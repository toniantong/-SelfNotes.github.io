<!DOCTYPE html>
<html>
<head>
  <title>上传并显示文件内容 (All-in-One)</title>
  <style>
    /* CSS 样式 */
    body {
      font-family: sans-serif;
    }
    #text-content {
      white-space: pre-wrap; /* 保留换行和空格 */
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
    }
    button {
      padding: 5px 10px;
      cursor: pointer;
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
  </style>
</head>
<body>

  <input type="file" id="file-input" accept=".txt,.md">
  <button id="copy-button" disabled>复制</button>
  <pre id="text-content">请选择一个文件。</pre>

  <script>
    // JavaScript 代码
    const fileInput = document.getElementById('file-input');
    const textContentElement = document.getElementById('text-content');
    const copyButton = document.getElementById('copy-button');

    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];

      if (file) {
        const reader = new FileReader();

        reader.onload = (e) => {
          const fileContent = e.target.result;
          textContentElement.innerText = fileContent;
          copyButton.disabled = false;
        };

        reader.onerror = (e) => {
          console.error('读取文件出错:', e);
          textContentElement.innerText = '读取文件出错！';
          copyButton.disabled = true;
        };

        reader.readAsText(file);
      } else {
        textContentElement.innerText = '请选择一个文件。';
        copyButton.disabled = true;
      }
    });

    copyButton.addEventListener('click', () => {
      const textToCopy = textContentElement.innerText;

      navigator.clipboard.writeText(textToCopy)
        .then(() => {
          alert('已复制到剪贴板！');
        })
        .catch(err => {
          console.error('复制失败: ', err);
          const textArea = document.createElement("textarea");
          textArea.value = textToCopy;
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();
          try {
            const successful = document.execCommand('copy');
            const msg = successful ? '成功' : '失败';
            alert('复制' + msg + '!');
          } catch (err) {
            console.error('复制失败: ', err);
            alert('复制失败，请手动复制。');
          }
          document.body.removeChild(textArea);
        });
    });
  </script>

</body>
</html>